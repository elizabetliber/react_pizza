{"ast":null,"code":"var assert = require('assert');\n\nvar util = require('util');\n\nvar EventEmitter = require('events').EventEmitter;\n\nvar Buffer = require('buffer').Buffer;\n\nvar Queue = require('./queue'); // Node.js version\n\n\nvar match = /^v(\\d+)\\.(\\d+)\\./.exec(process.version);\nvar version = match ? Number(match[1]) + Number('0.' + match[2]) : 11;\nvar onreadMode = version >= 11.1 ? 2 : 1;\nvar mode = 'modern';\nvar setNRead;\n\nif (onreadMode === 2) {\n  var sw = process.binding('stream_wrap');\n\n  setNRead = function (nread) {\n    sw.streamBaseState[sw.kReadBytesOrError] = nread;\n  };\n}\n\nfunction Handle(stream, options) {\n  EventEmitter.call(this);\n  this._stream = stream;\n  this._flowing = false;\n  this._reading = false;\n  this._options = options || {};\n  this.onread = null; // Pending requests\n\n  this.pending = new Queue();\n}\n\nutil.inherits(Handle, EventEmitter);\nmodule.exports = Handle;\nHandle.mode = mode;\n\nHandle.create = function create(stream, options) {\n  return new Handle(stream, options);\n};\n\nHandle.prototype._onread = function _onread(nread, buffer) {\n  if (onreadMode === 1) {\n    this.onread(nread, buffer);\n  } else {\n    setNRead(nread);\n    this.onread(buffer);\n  }\n};\n\nHandle.prototype._queueReq = function _queueReq(type, req) {\n  return this.pending.append(type, req);\n};\n\nHandle.prototype._pendingList = function _pendingList() {\n  var list = [];\n\n  while (!this.pending.isEmpty()) {\n    list.push(this.pending.first().dequeue());\n  }\n\n  return list;\n};\n\nHandle.prototype.setStream = function setStream(stream) {\n  assert(this._stream === null, 'Can\\'t set stream two times');\n  this._stream = stream;\n  this.emit('stream', stream);\n};\n\nHandle.prototype.readStart = function readStart() {\n  this._reading = true;\n\n  if (!this._stream) {\n    this.once('stream', this.readStart);\n    return 0;\n  }\n\n  if (!this._flowing) {\n    this._flowing = true;\n\n    this._flow();\n  }\n\n  this._stream.resume();\n\n  return 0;\n};\n\nHandle.prototype.readStop = function readStop() {\n  this._reading = false;\n\n  if (!this._stream) {\n    this.once('stream', this.readStop);\n    return 0;\n  }\n\n  this._stream.pause();\n\n  return 0;\n};\n\nvar uv = process.binding('uv');\n\nHandle.prototype._flow = function flow() {\n  var self = this;\n\n  this._stream.on('data', function (chunk) {\n    self._onread(chunk.length, chunk);\n  });\n\n  this._stream.on('end', function () {\n    self._onread(uv.UV_EOF, Buffer.alloc(0));\n  });\n\n  this._stream.on('close', function () {\n    setImmediate(function () {\n      if (self._reading) {\n        self._onread(uv.UV_ECONNRESET, Buffer.alloc(0));\n      }\n    });\n  });\n};\n\nHandle.prototype._close = function _close() {\n  var list = this._pendingList();\n\n  var self = this;\n  setImmediate(function () {\n    for (var i = 0; i < list.length; i++) {\n      var req = list[i];\n      req.oncomplete(uv.UV_ECANCELED, self, req);\n    }\n  });\n  this.readStop();\n};\n\nHandle.prototype.shutdown = function shutdown(req) {\n  var wrap = this._queueReq('shutdown', req);\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this._shutdown(wrap);\n    });\n    return 0;\n  }\n\n  return this._shutdown(wrap);\n};\n\nHandle.prototype._shutdown = function _shutdown(wrap) {\n  var self = this;\n\n  this._stream.end(function () {\n    var req = wrap.dequeue();\n\n    if (!req) {\n      return;\n    }\n\n    req.oncomplete(0, self, req);\n  });\n\n  return 0;\n};\n\nHandle.prototype.close = function close(callback) {\n  this._close();\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this.close(callback);\n    });\n    return 0;\n  }\n\n  if (this._options.close) {\n    this._options.close(callback);\n  } else {\n    process.nextTick(callback);\n  }\n\n  return 0;\n};\n\nHandle.prototype.writeEnc = function writeEnc(req, data, enc) {\n  var wrap = this._queueReq('write', req);\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this._writeEnc(wrap, req, data, enc);\n    });\n    return 0;\n  }\n\n  return this._writeEnc(wrap, req, data, enc);\n};\n\nHandle.prototype._writeEnc = function _writeEnc(wrap, req, data, enc) {\n  var self = this;\n  req.async = true;\n  req.bytes = data.length;\n\n  if (wrap.isEmpty()) {\n    return 0;\n  }\n\n  this._stream.write(data, enc, function () {\n    var req = wrap.dequeue();\n\n    if (!req) {\n      return;\n    }\n\n    req.oncomplete(0, self, req);\n  });\n\n  return 0;\n};\n/**\n * @param {WriteWrap} req\n * @param {string[]} chunks\n * @param {Boolean} allBuffers\n */\n\n\nHandle.prototype.writev = function _writev(req, chunks, allBuffers) {\n  while (chunks.length > 0) {\n    this._stream.write(chunks.shift(), chunks.shift());\n  }\n\n  return 0;\n};\n\nHandle.prototype.writeBuffer = function writeBuffer(req, data) {\n  return this.writeEnc(req, data, null);\n};\n\nHandle.prototype.writeAsciiString = function writeAsciiString(req, data) {\n  return this.writeEnc(req, data, 'ascii');\n};\n\nHandle.prototype.writeUtf8String = function writeUtf8String(req, data) {\n  return this.writeEnc(req, data, 'utf8');\n};\n\nHandle.prototype.writeUcs2String = function writeUcs2String(req, data) {\n  return this.writeEnc(req, data, 'ucs2');\n};\n\nHandle.prototype.writeBinaryString = function writeBinaryString(req, data) {\n  return this.writeEnc(req, data, 'binary');\n};\n\nHandle.prototype.writeLatin1String = function writeLatin1String(req, data) {\n  return this.writeEnc(req, data, 'binary');\n}; // v0.8\n\n\nHandle.prototype.getsockname = function getsockname() {\n  if (this._options.getPeerName) {\n    return this._options.getPeerName();\n  }\n\n  return null;\n};\n\nHandle.prototype.getpeername = function getpeername(out) {\n  var res = this.getsockname();\n\n  if (!res) {\n    return -1;\n  }\n\n  Object.keys(res).forEach(function (key) {\n    out[key] = res[key];\n  });\n  return 0;\n};","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/handle-thing/lib/handle.js"],"names":["assert","require","util","EventEmitter","Buffer","Queue","match","exec","process","version","Number","onreadMode","mode","setNRead","sw","binding","nread","streamBaseState","kReadBytesOrError","Handle","stream","options","call","_stream","_flowing","_reading","_options","onread","pending","inherits","module","exports","create","prototype","_onread","buffer","_queueReq","type","req","append","_pendingList","list","isEmpty","push","first","dequeue","setStream","emit","readStart","once","_flow","resume","readStop","pause","uv","flow","self","on","chunk","length","UV_EOF","alloc","setImmediate","UV_ECONNRESET","_close","i","oncomplete","UV_ECANCELED","shutdown","wrap","_shutdown","end","close","callback","nextTick","writeEnc","data","enc","_writeEnc","async","bytes","write","writev","_writev","chunks","allBuffers","shift","writeBuffer","writeAsciiString","writeUtf8String","writeUcs2String","writeBinaryString","writeLatin1String","getsockname","getPeerName","getpeername","out","res","Object","keys","forEach","key"],"mappings":"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","sourcesContent":["var assert = require('assert')\nvar util = require('util')\n\nvar EventEmitter = require('events').EventEmitter\nvar Buffer = require('buffer').Buffer\n\nvar Queue = require('./queue')\n\n// Node.js version\nvar match = /^v(\\d+)\\.(\\d+)\\./.exec(process.version)\nvar version = match ? Number(match[1]) + Number('0.' + match[2]) : 11\nvar onreadMode = version >= 11.1 ? 2 : 1\nvar mode = 'modern'\n\nvar setNRead\nif (onreadMode === 2) {\n  var sw = process.binding('stream_wrap')\n  setNRead = function (nread) {\n    sw.streamBaseState[sw.kReadBytesOrError] = nread\n  }\n}\n\nfunction Handle (stream, options) {\n  EventEmitter.call(this)\n\n  this._stream = stream\n  this._flowing = false\n  this._reading = false\n  this._options = options || {}\n\n  this.onread = null\n\n  // Pending requests\n  this.pending = new Queue()\n}\nutil.inherits(Handle, EventEmitter)\nmodule.exports = Handle\n\nHandle.mode = mode\n\nHandle.create = function create (stream, options) {\n  return new Handle(stream, options)\n}\n\nHandle.prototype._onread = function _onread (nread, buffer) {\n  if (onreadMode === 1) {\n    this.onread(nread, buffer)\n  } else {\n    setNRead(nread)\n    this.onread(buffer)\n  }\n}\n\nHandle.prototype._queueReq = function _queueReq (type, req) {\n  return this.pending.append(type, req)\n}\n\nHandle.prototype._pendingList = function _pendingList () {\n  var list = []\n  while (!this.pending.isEmpty()) { list.push(this.pending.first().dequeue()) }\n  return list\n}\n\nHandle.prototype.setStream = function setStream (stream) {\n  assert(this._stream === null, 'Can\\'t set stream two times')\n  this._stream = stream\n\n  this.emit('stream', stream)\n}\n\nHandle.prototype.readStart = function readStart () {\n  this._reading = true\n\n  if (!this._stream) {\n    this.once('stream', this.readStart)\n    return 0\n  }\n\n  if (!this._flowing) {\n    this._flowing = true\n    this._flow()\n  }\n\n  this._stream.resume()\n  return 0\n}\n\nHandle.prototype.readStop = function readStop () {\n  this._reading = false\n\n  if (!this._stream) {\n    this.once('stream', this.readStop)\n    return 0\n  }\n  this._stream.pause()\n  return 0\n}\n\nvar uv = process.binding('uv')\n\nHandle.prototype._flow = function flow () {\n  var self = this\n  this._stream.on('data', function (chunk) {\n    self._onread(chunk.length, chunk)\n  })\n\n  this._stream.on('end', function () {\n    self._onread(uv.UV_EOF, Buffer.alloc(0))\n  })\n\n  this._stream.on('close', function () {\n    setImmediate(function () {\n      if (self._reading) {\n        self._onread(uv.UV_ECONNRESET, Buffer.alloc(0))\n      }\n    })\n  })\n}\n\nHandle.prototype._close = function _close () {\n  var list = this._pendingList()\n\n  var self = this\n  setImmediate(function () {\n    for (var i = 0; i < list.length; i++) {\n      var req = list[i]\n      req.oncomplete(uv.UV_ECANCELED, self, req)\n    }\n  })\n\n  this.readStop()\n}\n\nHandle.prototype.shutdown = function shutdown (req) {\n  var wrap = this._queueReq('shutdown', req)\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this._shutdown(wrap)\n    })\n    return 0\n  }\n\n  return this._shutdown(wrap)\n}\n\nHandle.prototype._shutdown = function _shutdown (wrap) {\n  var self = this\n  this._stream.end(function () {\n    var req = wrap.dequeue()\n    if (!req) { return }\n\n    req.oncomplete(0, self, req)\n  })\n  return 0\n}\n\nHandle.prototype.close = function close (callback) {\n  this._close()\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this.close(callback)\n    })\n    return 0\n  }\n\n  if (this._options.close) {\n    this._options.close(callback)\n  } else {\n    process.nextTick(callback)\n  }\n\n  return 0\n}\n\nHandle.prototype.writeEnc = function writeEnc (req, data, enc) {\n  var wrap = this._queueReq('write', req)\n\n  if (!this._stream) {\n    this.once('stream', function () {\n      this._writeEnc(wrap, req, data, enc)\n    })\n\n    return 0\n  }\n\n  return this._writeEnc(wrap, req, data, enc)\n}\n\nHandle.prototype._writeEnc = function _writeEnc (wrap, req, data, enc) {\n  var self = this\n\n  req.async = true\n  req.bytes = data.length\n\n  if (wrap.isEmpty()) {\n    return 0\n  }\n\n  this._stream.write(data, enc, function () {\n    var req = wrap.dequeue()\n    if (!req) { return }\n    req.oncomplete(0, self, req)\n  })\n\n  return 0\n}\n\n/**\n * @param {WriteWrap} req\n * @param {string[]} chunks\n * @param {Boolean} allBuffers\n */\nHandle.prototype.writev = function _writev (req, chunks, allBuffers) {\n  while (chunks.length > 0) {\n    this._stream.write(chunks.shift(), chunks.shift())\n  }\n  return 0\n}\n\nHandle.prototype.writeBuffer = function writeBuffer (req, data) {\n  return this.writeEnc(req, data, null)\n}\n\nHandle.prototype.writeAsciiString = function writeAsciiString (req, data) {\n  return this.writeEnc(req, data, 'ascii')\n}\n\nHandle.prototype.writeUtf8String = function writeUtf8String (req, data) {\n  return this.writeEnc(req, data, 'utf8')\n}\n\nHandle.prototype.writeUcs2String = function writeUcs2String (req, data) {\n  return this.writeEnc(req, data, 'ucs2')\n}\n\nHandle.prototype.writeBinaryString = function writeBinaryString (req, data) {\n  return this.writeEnc(req, data, 'binary')\n}\n\nHandle.prototype.writeLatin1String = function writeLatin1String (req, data) {\n  return this.writeEnc(req, data, 'binary')\n}\n\n// v0.8\nHandle.prototype.getsockname = function getsockname () {\n  if (this._options.getPeerName) {\n    return this._options.getPeerName()\n  }\n  return null\n}\n\nHandle.prototype.getpeername = function getpeername (out) {\n  var res = this.getsockname()\n  if (!res) { return -1 }\n\n  Object.keys(res).forEach(function (key) {\n    out[key] = res[key]\n  })\n\n  return 0\n}\n"]},"metadata":{},"sourceType":"script"}