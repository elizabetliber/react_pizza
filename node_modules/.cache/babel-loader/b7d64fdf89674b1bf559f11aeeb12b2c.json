{"ast":null,"code":"// API references:\n//\n// * https://html.spec.whatwg.org/multipage/comms.html#network\n// * https://dom.spec.whatwg.org/#interface-eventtarget\n// * https://dom.spec.whatwg.org/#interface-event\n'use strict';\n\nvar util = require('util'),\n    driver = require('websocket-driver'),\n    API = require('./websocket/api');\n\nvar WebSocket = function (request, socket, body, protocols, options) {\n  options = options || {};\n  this._stream = socket;\n  this._driver = driver.http(request, {\n    maxLength: options.maxLength,\n    protocols: protocols\n  });\n  var self = this;\n  if (!this._stream || !this._stream.writable) return;\n  if (!this._stream.readable) return this._stream.end();\n\n  var catchup = function () {\n    self._stream.removeListener('data', catchup);\n  };\n\n  this._stream.on('data', catchup);\n\n  API.call(this, options);\n  process.nextTick(function () {\n    self._driver.start();\n\n    self._driver.io.write(body);\n  });\n};\n\nutil.inherits(WebSocket, API);\n\nWebSocket.isWebSocket = function (request) {\n  return driver.isWebSocket(request);\n};\n\nWebSocket.validateOptions = function (options, validKeys) {\n  driver.validateOptions(options, validKeys);\n};\n\nWebSocket.WebSocket = WebSocket;\nWebSocket.Client = require('./websocket/client');\nWebSocket.EventSource = require('./eventsource');\nmodule.exports = WebSocket;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/faye-websocket/lib/faye/websocket.js"],"names":["util","require","driver","API","WebSocket","request","socket","body","protocols","options","_stream","_driver","http","maxLength","self","writable","readable","end","catchup","removeListener","on","call","process","nextTick","start","io","write","inherits","isWebSocket","validateOptions","validKeys","Client","EventSource","module","exports"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AAEA;;AAEA,IAAIA,IAAI,GAAKC,OAAO,CAAC,MAAD,CAApB;AAAA,IACIC,MAAM,GAAGD,OAAO,CAAC,kBAAD,CADpB;AAAA,IAEIE,GAAG,GAAMF,OAAO,CAAC,iBAAD,CAFpB;;AAIA,IAAIG,SAAS,GAAG,UAASC,OAAT,EAAkBC,MAAlB,EAA0BC,IAA1B,EAAgCC,SAAhC,EAA2CC,OAA3C,EAAoD;AAClEA,EAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AAEA,OAAKC,OAAL,GAAeJ,MAAf;AACA,OAAKK,OAAL,GAAeT,MAAM,CAACU,IAAP,CAAYP,OAAZ,EAAqB;AAACQ,IAAAA,SAAS,EAAEJ,OAAO,CAACI,SAApB;AAA+BL,IAAAA,SAAS,EAAEA;AAA1C,GAArB,CAAf;AAEA,MAAIM,IAAI,GAAG,IAAX;AACA,MAAI,CAAC,KAAKJ,OAAN,IAAiB,CAAC,KAAKA,OAAL,CAAaK,QAAnC,EAA6C;AAC7C,MAAI,CAAC,KAAKL,OAAL,CAAaM,QAAlB,EAA4B,OAAO,KAAKN,OAAL,CAAaO,GAAb,EAAP;;AAE5B,MAAIC,OAAO,GAAG,YAAW;AAAEJ,IAAAA,IAAI,CAACJ,OAAL,CAAaS,cAAb,CAA4B,MAA5B,EAAoCD,OAApC;AAA8C,GAAzE;;AACA,OAAKR,OAAL,CAAaU,EAAb,CAAgB,MAAhB,EAAwBF,OAAxB;;AAEAf,EAAAA,GAAG,CAACkB,IAAJ,CAAS,IAAT,EAAeZ,OAAf;AAEAa,EAAAA,OAAO,CAACC,QAAR,CAAiB,YAAW;AAC1BT,IAAAA,IAAI,CAACH,OAAL,CAAaa,KAAb;;AACAV,IAAAA,IAAI,CAACH,OAAL,CAAac,EAAb,CAAgBC,KAAhB,CAAsBnB,IAAtB;AACD,GAHD;AAID,CAnBD;;AAoBAP,IAAI,CAAC2B,QAAL,CAAcvB,SAAd,EAAyBD,GAAzB;;AAEAC,SAAS,CAACwB,WAAV,GAAwB,UAASvB,OAAT,EAAkB;AACxC,SAAOH,MAAM,CAAC0B,WAAP,CAAmBvB,OAAnB,CAAP;AACD,CAFD;;AAIAD,SAAS,CAACyB,eAAV,GAA4B,UAASpB,OAAT,EAAkBqB,SAAlB,EAA6B;AACvD5B,EAAAA,MAAM,CAAC2B,eAAP,CAAuBpB,OAAvB,EAAgCqB,SAAhC;AACD,CAFD;;AAIA1B,SAAS,CAACA,SAAV,GAAwBA,SAAxB;AACAA,SAAS,CAAC2B,MAAV,GAAwB9B,OAAO,CAAC,oBAAD,CAA/B;AACAG,SAAS,CAAC4B,WAAV,GAAwB/B,OAAO,CAAC,eAAD,CAA/B;AAEAgC,MAAM,CAACC,OAAP,GAAwB9B,SAAxB","sourcesContent":["// API references:\n//\n// * https://html.spec.whatwg.org/multipage/comms.html#network\n// * https://dom.spec.whatwg.org/#interface-eventtarget\n// * https://dom.spec.whatwg.org/#interface-event\n\n'use strict';\n\nvar util   = require('util'),\n    driver = require('websocket-driver'),\n    API    = require('./websocket/api');\n\nvar WebSocket = function(request, socket, body, protocols, options) {\n  options = options || {};\n\n  this._stream = socket;\n  this._driver = driver.http(request, {maxLength: options.maxLength, protocols: protocols});\n\n  var self = this;\n  if (!this._stream || !this._stream.writable) return;\n  if (!this._stream.readable) return this._stream.end();\n\n  var catchup = function() { self._stream.removeListener('data', catchup) };\n  this._stream.on('data', catchup);\n\n  API.call(this, options);\n\n  process.nextTick(function() {\n    self._driver.start();\n    self._driver.io.write(body);\n  });\n};\nutil.inherits(WebSocket, API);\n\nWebSocket.isWebSocket = function(request) {\n  return driver.isWebSocket(request);\n};\n\nWebSocket.validateOptions = function(options, validKeys) {\n  driver.validateOptions(options, validKeys);\n};\n\nWebSocket.WebSocket   = WebSocket;\nWebSocket.Client      = require('./websocket/client');\nWebSocket.EventSource = require('./eventsource');\n\nmodule.exports        = WebSocket;\n"]},"metadata":{},"sourceType":"script"}