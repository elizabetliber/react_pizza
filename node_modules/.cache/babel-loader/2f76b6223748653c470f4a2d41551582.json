{"ast":null,"code":"'use strict';\n\nvar Stream = require('stream').Stream,\n    util = require('util'),\n    driver = require('websocket-driver'),\n    EventTarget = require('./api/event_target'),\n    Event = require('./api/event');\n\nvar API = function (options) {\n  options = options || {};\n  driver.validateOptions(options, ['headers', 'extensions', 'maxLength', 'ping', 'proxy', 'tls', 'ca']);\n  this.readable = this.writable = true;\n  var headers = options.headers;\n\n  if (headers) {\n    for (var name in headers) this._driver.setHeader(name, headers[name]);\n  }\n\n  var extensions = options.extensions;\n\n  if (extensions) {\n    [].concat(extensions).forEach(this._driver.addExtension, this._driver);\n  }\n\n  this._ping = options.ping;\n  this._pingId = 0;\n  this.readyState = API.CONNECTING;\n  this.bufferedAmount = 0;\n  this.protocol = '';\n  this.url = this._driver.url;\n  this.version = this._driver.version;\n  var self = this;\n\n  this._driver.on('open', function (e) {\n    self._open();\n  });\n\n  this._driver.on('message', function (e) {\n    self._receiveMessage(e.data);\n  });\n\n  this._driver.on('close', function (e) {\n    self._beginClose(e.reason, e.code);\n  });\n\n  this._driver.on('error', function (error) {\n    self._emitError(error.message);\n  });\n\n  this.on('error', function () {});\n\n  this._driver.messages.on('drain', function () {\n    self.emit('drain');\n  });\n\n  if (this._ping) this._pingTimer = setInterval(function () {\n    self._pingId += 1;\n    self.ping(self._pingId.toString());\n  }, this._ping * 1000);\n\n  this._configureStream();\n\n  if (!this._proxy) {\n    this._stream.pipe(this._driver.io);\n\n    this._driver.io.pipe(this._stream);\n  }\n};\n\nutil.inherits(API, Stream);\nAPI.CONNECTING = 0;\nAPI.OPEN = 1;\nAPI.CLOSING = 2;\nAPI.CLOSED = 3;\nAPI.CLOSE_TIMEOUT = 30000;\nvar instance = {\n  write: function (data) {\n    return this.send(data);\n  },\n  end: function (data) {\n    if (data !== undefined) this.send(data);\n    this.close();\n  },\n  pause: function () {\n    return this._driver.messages.pause();\n  },\n  resume: function () {\n    return this._driver.messages.resume();\n  },\n  send: function (data) {\n    if (this.readyState > API.OPEN) return false;\n    if (!(data instanceof Buffer)) data = String(data);\n    return this._driver.messages.write(data);\n  },\n  ping: function (message, callback) {\n    if (this.readyState > API.OPEN) return false;\n    return this._driver.ping(message, callback);\n  },\n  close: function (code, reason) {\n    if (code === undefined) code = 1000;\n    if (reason === undefined) reason = '';\n    if (code !== 1000 && (code < 3000 || code > 4999)) throw new Error(\"Failed to execute 'close' on WebSocket: \" + \"The code must be either 1000, or between 3000 and 4999. \" + code + \" is neither.\");\n    if (this.readyState !== API.CLOSED) this.readyState = API.CLOSING;\n    var self = this;\n    this._closeTimer = setTimeout(function () {\n      self._beginClose('', 1006);\n    }, API.CLOSE_TIMEOUT);\n\n    this._driver.close(reason, code);\n  },\n  _configureStream: function () {\n    var self = this;\n\n    this._stream.setTimeout(0);\n\n    this._stream.setNoDelay(true);\n\n    ['close', 'end'].forEach(function (event) {\n      this._stream.on(event, function () {\n        self._finalizeClose();\n      });\n    }, this);\n\n    this._stream.on('error', function (error) {\n      self._emitError('Network error: ' + self.url + ': ' + error.message);\n\n      self._finalizeClose();\n    });\n  },\n  _open: function () {\n    if (this.readyState !== API.CONNECTING) return;\n    this.readyState = API.OPEN;\n    this.protocol = this._driver.protocol || '';\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n  _receiveMessage: function (data) {\n    if (this.readyState > API.OPEN) return false;\n    if (this.readable) this.emit('data', data);\n    var event = new Event('message', {\n      data: data\n    });\n    event.initEvent('message', false, false);\n    this.dispatchEvent(event);\n  },\n  _emitError: function (message) {\n    if (this.readyState >= API.CLOSING) return;\n    var event = new Event('error', {\n      message: message\n    });\n    event.initEvent('error', false, false);\n    this.dispatchEvent(event);\n  },\n  _beginClose: function (reason, code) {\n    if (this.readyState === API.CLOSED) return;\n    this.readyState = API.CLOSING;\n    this._closeParams = [reason, code];\n\n    if (this._stream) {\n      this._stream.destroy();\n\n      if (!this._stream.readable) this._finalizeClose();\n    }\n  },\n  _finalizeClose: function () {\n    if (this.readyState === API.CLOSED) return;\n    this.readyState = API.CLOSED;\n    if (this._closeTimer) clearTimeout(this._closeTimer);\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n    if (this.readable) this.emit('end');\n    this.readable = this.writable = false;\n    var reason = this._closeParams ? this._closeParams[0] : '',\n        code = this._closeParams ? this._closeParams[1] : 1006;\n    var event = new Event('close', {\n      code: code,\n      reason: reason\n    });\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n  }\n};\n\nfor (var method in instance) API.prototype[method] = instance[method];\n\nfor (var key in EventTarget) API.prototype[key] = EventTarget[key];\n\nmodule.exports = API;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/faye-websocket/lib/faye/websocket/api.js"],"names":["Stream","require","util","driver","EventTarget","Event","API","options","validateOptions","readable","writable","headers","name","_driver","setHeader","extensions","concat","forEach","addExtension","_ping","ping","_pingId","readyState","CONNECTING","bufferedAmount","protocol","url","version","self","on","e","_open","_receiveMessage","data","_beginClose","reason","code","error","_emitError","message","messages","emit","_pingTimer","setInterval","toString","_configureStream","_proxy","_stream","pipe","io","inherits","OPEN","CLOSING","CLOSED","CLOSE_TIMEOUT","instance","write","send","end","undefined","close","pause","resume","Buffer","String","callback","Error","_closeTimer","setTimeout","setNoDelay","event","_finalizeClose","initEvent","dispatchEvent","_closeParams","destroy","clearTimeout","clearInterval","method","prototype","key","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Stream      = require('stream').Stream,\n    util        = require('util'),\n    driver      = require('websocket-driver'),\n    EventTarget = require('./api/event_target'),\n    Event       = require('./api/event');\n\nvar API = function(options) {\n  options = options || {};\n  driver.validateOptions(options, ['headers', 'extensions', 'maxLength', 'ping', 'proxy', 'tls', 'ca']);\n\n  this.readable = this.writable = true;\n\n  var headers = options.headers;\n  if (headers) {\n    for (var name in headers) this._driver.setHeader(name, headers[name]);\n  }\n\n  var extensions = options.extensions;\n  if (extensions) {\n    [].concat(extensions).forEach(this._driver.addExtension, this._driver);\n  }\n\n  this._ping          = options.ping;\n  this._pingId        = 0;\n  this.readyState     = API.CONNECTING;\n  this.bufferedAmount = 0;\n  this.protocol       = '';\n  this.url            = this._driver.url;\n  this.version        = this._driver.version;\n\n  var self = this;\n\n  this._driver.on('open',    function(e) { self._open() });\n  this._driver.on('message', function(e) { self._receiveMessage(e.data) });\n  this._driver.on('close',   function(e) { self._beginClose(e.reason, e.code) });\n\n  this._driver.on('error', function(error) {\n    self._emitError(error.message);\n  });\n  this.on('error', function() {});\n\n  this._driver.messages.on('drain', function() {\n    self.emit('drain');\n  });\n\n  if (this._ping)\n    this._pingTimer = setInterval(function() {\n      self._pingId += 1;\n      self.ping(self._pingId.toString());\n    }, this._ping * 1000);\n\n  this._configureStream();\n\n  if (!this._proxy) {\n    this._stream.pipe(this._driver.io);\n    this._driver.io.pipe(this._stream);\n  }\n};\nutil.inherits(API, Stream);\n\nAPI.CONNECTING = 0;\nAPI.OPEN       = 1;\nAPI.CLOSING    = 2;\nAPI.CLOSED     = 3;\n\nAPI.CLOSE_TIMEOUT = 30000;\n\nvar instance = {\n  write: function(data) {\n    return this.send(data);\n  },\n\n  end: function(data) {\n    if (data !== undefined) this.send(data);\n    this.close();\n  },\n\n  pause: function() {\n    return this._driver.messages.pause();\n  },\n\n  resume: function() {\n    return this._driver.messages.resume();\n  },\n\n  send: function(data) {\n    if (this.readyState > API.OPEN) return false;\n    if (!(data instanceof Buffer)) data = String(data);\n    return this._driver.messages.write(data);\n  },\n\n  ping: function(message, callback) {\n    if (this.readyState > API.OPEN) return false;\n    return this._driver.ping(message, callback);\n  },\n\n  close: function(code, reason) {\n    if (code === undefined) code = 1000;\n    if (reason === undefined) reason = '';\n\n    if (code !== 1000 && (code < 3000 || code > 4999))\n      throw new Error(\"Failed to execute 'close' on WebSocket: \" +\n                      \"The code must be either 1000, or between 3000 and 4999. \" +\n                      code + \" is neither.\");\n\n    if (this.readyState !== API.CLOSED) this.readyState = API.CLOSING;\n    var self = this;\n\n    this._closeTimer = setTimeout(function() {\n      self._beginClose('', 1006);\n    }, API.CLOSE_TIMEOUT);\n\n    this._driver.close(reason, code);\n  },\n\n  _configureStream: function() {\n    var self = this;\n\n    this._stream.setTimeout(0);\n    this._stream.setNoDelay(true);\n\n    ['close', 'end'].forEach(function(event) {\n      this._stream.on(event, function() { self._finalizeClose() });\n    }, this);\n\n    this._stream.on('error', function(error) {\n      self._emitError('Network error: ' + self.url + ': ' + error.message);\n      self._finalizeClose();\n    });\n  },\n\n  _open: function() {\n    if (this.readyState !== API.CONNECTING) return;\n\n    this.readyState = API.OPEN;\n    this.protocol = this._driver.protocol || '';\n\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n\n  _receiveMessage: function(data) {\n    if (this.readyState > API.OPEN) return false;\n\n    if (this.readable) this.emit('data', data);\n\n    var event = new Event('message', {data: data});\n    event.initEvent('message', false, false);\n    this.dispatchEvent(event);\n  },\n\n  _emitError: function(message) {\n    if (this.readyState >= API.CLOSING) return;\n\n    var event = new Event('error', {message: message});\n    event.initEvent('error', false, false);\n    this.dispatchEvent(event);\n  },\n\n  _beginClose: function(reason, code) {\n    if (this.readyState === API.CLOSED) return;\n    this.readyState = API.CLOSING;\n    this._closeParams = [reason, code];\n\n    if (this._stream) {\n      this._stream.destroy();\n      if (!this._stream.readable) this._finalizeClose();\n    }\n  },\n\n  _finalizeClose: function() {\n    if (this.readyState === API.CLOSED) return;\n    this.readyState = API.CLOSED;\n\n    if (this._closeTimer) clearTimeout(this._closeTimer);\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n\n    if (this.readable) this.emit('end');\n    this.readable = this.writable = false;\n\n    var reason = this._closeParams ? this._closeParams[0] : '',\n        code   = this._closeParams ? this._closeParams[1] : 1006;\n\n    var event = new Event('close', {code: code, reason: reason});\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n  }\n};\n\nfor (var method in instance) API.prototype[method] = instance[method];\nfor (var key in EventTarget) API.prototype[key] = EventTarget[key];\n\nmodule.exports = API;\n"]},"metadata":{},"sourceType":"script"}