{"ast":null,"code":"'use strict';\n\nvar util = require('util'),\n    net = require('net'),\n    tls = require('tls'),\n    url = require('url'),\n    driver = require('websocket-driver'),\n    API = require('./api'),\n    Event = require('./api/event');\n\nvar DEFAULT_PORTS = {\n  'http:': 80,\n  'https:': 443,\n  'ws:': 80,\n  'wss:': 443\n},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function (_url, protocols, options) {\n  options = options || {};\n  this.url = _url;\n  this._driver = driver.client(this.url, {\n    maxLength: options.maxLength,\n    protocols: protocols\n  });\n  ['open', 'error'].forEach(function (event) {\n    this._driver.on(event, function () {\n      self.headers = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy = options.proxy || {},\n      endpoint = url.parse(proxy.origin || this.url),\n      port = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect = function () {\n    self._onConnect();\n  },\n      netOptions = options.net || {},\n      originTLS = options.tls || {},\n      socketTLS = proxy.origin ? proxy.tls || {} : originTLS,\n      self = this;\n\n  netOptions.host = socketTLS.host = endpoint.hostname;\n  netOptions.port = socketTLS.port = port;\n  originTLS.ca = originTLS.ca || options.ca;\n  socketTLS.servername = socketTLS.servername || endpoint.hostname;\n  this._stream = secure ? tls.connect(socketTLS, onConnect) : net.connect(netOptions, onConnect);\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n  API.call(this, options);\n};\n\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function () {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function (proxy, originTLS) {\n  var uri = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self = this,\n      name;\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {\n    end: false\n  });\n\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function () {\n    if (secure) {\n      var options = {\n        socket: self._stream,\n        servername: uri.hostname\n      };\n\n      for (name in originTLS) options[name] = originTLS[name];\n\n      self._stream = tls.connect(options);\n\n      self._configureStream();\n    }\n\n    self._driver.io.pipe(self._stream);\n\n    self._stream.pipe(self._driver.io);\n\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function (error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/faye-websocket/lib/faye/websocket/client.js"],"names":["util","require","net","tls","url","driver","API","Event","DEFAULT_PORTS","SECURE_PROTOCOLS","Client","_url","protocols","options","_driver","client","maxLength","forEach","event","on","self","headers","statusCode","proxy","endpoint","parse","origin","port","protocol","secure","indexOf","onConnect","_onConnect","netOptions","originTLS","socketTLS","host","hostname","ca","servername","_stream","connect","_configureProxy","call","inherits","prototype","worker","_proxy","start","uri","name","setHeader","pipe","end","socket","_configureStream","io","error","emit","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar util   = require('util'),\n    net    = require('net'),\n    tls    = require('tls'),\n    url    = require('url'),\n    driver = require('websocket-driver'),\n    API    = require('./api'),\n    Event  = require('./api/event');\n\nvar DEFAULT_PORTS    = {'http:': 80, 'https:': 443, 'ws:':80, 'wss:': 443},\n    SECURE_PROTOCOLS = ['https:', 'wss:'];\n\nvar Client = function(_url, protocols, options) {\n  options = options || {};\n\n  this.url     = _url;\n  this._driver = driver.client(this.url, {maxLength: options.maxLength, protocols: protocols});\n\n  ['open', 'error'].forEach(function(event) {\n    this._driver.on(event, function() {\n      self.headers    = self._driver.headers;\n      self.statusCode = self._driver.statusCode;\n    });\n  }, this);\n\n  var proxy      = options.proxy || {},\n      endpoint   = url.parse(proxy.origin || this.url),\n      port       = endpoint.port || DEFAULT_PORTS[endpoint.protocol],\n      secure     = SECURE_PROTOCOLS.indexOf(endpoint.protocol) >= 0,\n      onConnect  = function() { self._onConnect() },\n      netOptions = options.net || {},\n      originTLS  = options.tls || {},\n      socketTLS  = proxy.origin ? (proxy.tls || {}) : originTLS,\n      self       = this;\n\n  netOptions.host = socketTLS.host = endpoint.hostname;\n  netOptions.port = socketTLS.port = port;\n\n  originTLS.ca = originTLS.ca || options.ca;\n  socketTLS.servername = socketTLS.servername || endpoint.hostname;\n\n  this._stream = secure\n               ? tls.connect(socketTLS, onConnect)\n               : net.connect(netOptions, onConnect);\n\n  if (proxy.origin) this._configureProxy(proxy, originTLS);\n\n  API.call(this, options);\n};\nutil.inherits(Client, API);\n\nClient.prototype._onConnect = function() {\n  var worker = this._proxy || this._driver;\n  worker.start();\n};\n\nClient.prototype._configureProxy = function(proxy, originTLS) {\n  var uri    = url.parse(this.url),\n      secure = SECURE_PROTOCOLS.indexOf(uri.protocol) >= 0,\n      self   = this,\n      name;\n\n  this._proxy = this._driver.proxy(proxy.origin);\n\n  if (proxy.headers) {\n    for (name in proxy.headers) this._proxy.setHeader(name, proxy.headers[name]);\n  }\n\n  this._proxy.pipe(this._stream, {end: false});\n  this._stream.pipe(this._proxy);\n\n  this._proxy.on('connect', function() {\n    if (secure) {\n      var options = {socket: self._stream, servername: uri.hostname};\n      for (name in originTLS) options[name] = originTLS[name];\n      self._stream = tls.connect(options);\n      self._configureStream();\n    }\n    self._driver.io.pipe(self._stream);\n    self._stream.pipe(self._driver.io);\n    self._driver.start();\n  });\n\n  this._proxy.on('error', function(error) {\n    self._driver.emit('error', error);\n  });\n};\n\nmodule.exports = Client;\n"]},"metadata":{},"sourceType":"script"}