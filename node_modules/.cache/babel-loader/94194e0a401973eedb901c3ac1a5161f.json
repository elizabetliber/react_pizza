{"ast":null,"code":"'use strict';\n\nvar Stream = require('stream').Stream,\n    util = require('util'),\n    driver = require('websocket-driver'),\n    Headers = require('websocket-driver/lib/websocket/driver/headers'),\n    API = require('./websocket/api'),\n    EventTarget = require('./websocket/api/event_target'),\n    Event = require('./websocket/api/event');\n\nvar EventSource = function (request, response, options) {\n  this.writable = true;\n  options = options || {};\n  this._stream = response.socket;\n  this._ping = options.ping || this.DEFAULT_PING;\n  this._retry = options.retry || this.DEFAULT_RETRY;\n  var scheme = driver.isSecureRequest(request) ? 'https:' : 'http:';\n  this.url = scheme + '//' + request.headers.host + request.url;\n  this.lastEventId = request.headers['last-event-id'] || '';\n  this.readyState = API.CONNECTING;\n  var headers = new Headers(),\n      self = this;\n\n  if (options.headers) {\n    for (var key in options.headers) headers.set(key, options.headers[key]);\n  }\n\n  if (!this._stream || !this._stream.writable) return;\n  process.nextTick(function () {\n    self._open();\n  });\n\n  this._stream.setTimeout(0);\n\n  this._stream.setNoDelay(true);\n\n  var handshake = 'HTTP/1.1 200 OK\\r\\n' + 'Content-Type: text/event-stream\\r\\n' + 'Cache-Control: no-cache, no-store\\r\\n' + 'Connection: close\\r\\n' + headers.toString() + '\\r\\n' + 'retry: ' + Math.floor(this._retry * 1000) + '\\r\\n\\r\\n';\n\n  this._write(handshake);\n\n  this._stream.on('drain', function () {\n    self.emit('drain');\n  });\n\n  if (this._ping) this._pingTimer = setInterval(function () {\n    self.ping();\n  }, this._ping * 1000);\n  ['error', 'end'].forEach(function (event) {\n    self._stream.on(event, function () {\n      self.close();\n    });\n  });\n};\n\nutil.inherits(EventSource, Stream);\n\nEventSource.isEventSource = function (request) {\n  if (request.method !== 'GET') return false;\n  var accept = (request.headers.accept || '').split(/\\s*,\\s*/);\n  return accept.indexOf('text/event-stream') >= 0;\n};\n\nvar instance = {\n  DEFAULT_PING: 10,\n  DEFAULT_RETRY: 5,\n  _write: function (chunk) {\n    if (!this.writable) return false;\n\n    try {\n      return this._stream.write(chunk, 'utf8');\n    } catch (e) {\n      return false;\n    }\n  },\n  _open: function () {\n    if (this.readyState !== API.CONNECTING) return;\n    this.readyState = API.OPEN;\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n  write: function (message) {\n    return this.send(message);\n  },\n  end: function (message) {\n    if (message !== undefined) this.write(message);\n    this.close();\n  },\n  send: function (message, options) {\n    if (this.readyState > API.OPEN) return false;\n    message = String(message).replace(/(\\r\\n|\\r|\\n)/g, '$1data: ');\n    options = options || {};\n    var frame = '';\n    if (options.event) frame += 'event: ' + options.event + '\\r\\n';\n    if (options.id) frame += 'id: ' + options.id + '\\r\\n';\n    frame += 'data: ' + message + '\\r\\n\\r\\n';\n    return this._write(frame);\n  },\n  ping: function () {\n    return this._write(':\\r\\n\\r\\n');\n  },\n  close: function () {\n    if (this.readyState > API.OPEN) return false;\n    this.readyState = API.CLOSED;\n    this.writable = false;\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n    var event = new Event('close');\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n    return true;\n  }\n};\n\nfor (var method in instance) EventSource.prototype[method] = instance[method];\n\nfor (var key in EventTarget) EventSource.prototype[key] = EventTarget[key];\n\nmodule.exports = EventSource;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/faye-websocket/lib/faye/eventsource.js"],"names":["Stream","require","util","driver","Headers","API","EventTarget","Event","EventSource","request","response","options","writable","_stream","socket","_ping","ping","DEFAULT_PING","_retry","retry","DEFAULT_RETRY","scheme","isSecureRequest","url","headers","host","lastEventId","readyState","CONNECTING","self","key","set","process","nextTick","_open","setTimeout","setNoDelay","handshake","toString","Math","floor","_write","on","emit","_pingTimer","setInterval","forEach","event","close","inherits","isEventSource","method","accept","split","indexOf","instance","chunk","write","e","OPEN","initEvent","dispatchEvent","message","send","end","undefined","String","replace","frame","id","CLOSED","clearInterval","prototype","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Stream      = require('stream').Stream,\n    util        = require('util'),\n    driver      = require('websocket-driver'),\n    Headers     = require('websocket-driver/lib/websocket/driver/headers'),\n    API         = require('./websocket/api'),\n    EventTarget = require('./websocket/api/event_target'),\n    Event       = require('./websocket/api/event');\n\nvar EventSource = function(request, response, options) {\n  this.writable = true;\n  options = options || {};\n\n  this._stream = response.socket;\n  this._ping   = options.ping  || this.DEFAULT_PING;\n  this._retry  = options.retry || this.DEFAULT_RETRY;\n\n  var scheme       = driver.isSecureRequest(request) ? 'https:' : 'http:';\n  this.url         = scheme + '//' + request.headers.host + request.url;\n  this.lastEventId = request.headers['last-event-id'] || '';\n  this.readyState  = API.CONNECTING;\n\n  var headers = new Headers(),\n      self    = this;\n\n  if (options.headers) {\n    for (var key in options.headers) headers.set(key, options.headers[key]);\n  }\n\n  if (!this._stream || !this._stream.writable) return;\n  process.nextTick(function() { self._open() });\n\n  this._stream.setTimeout(0);\n  this._stream.setNoDelay(true);\n\n  var handshake = 'HTTP/1.1 200 OK\\r\\n' +\n                  'Content-Type: text/event-stream\\r\\n' +\n                  'Cache-Control: no-cache, no-store\\r\\n' +\n                  'Connection: close\\r\\n' +\n                  headers.toString() +\n                  '\\r\\n' +\n                  'retry: ' + Math.floor(this._retry * 1000) + '\\r\\n\\r\\n';\n\n  this._write(handshake);\n\n  this._stream.on('drain', function() { self.emit('drain') });\n\n  if (this._ping)\n    this._pingTimer = setInterval(function() { self.ping() }, this._ping * 1000);\n\n  ['error', 'end'].forEach(function(event) {\n    self._stream.on(event, function() { self.close() });\n  });\n};\nutil.inherits(EventSource, Stream);\n\nEventSource.isEventSource = function(request) {\n  if (request.method !== 'GET') return false;\n  var accept = (request.headers.accept || '').split(/\\s*,\\s*/);\n  return accept.indexOf('text/event-stream') >= 0;\n};\n\nvar instance = {\n  DEFAULT_PING:   10,\n  DEFAULT_RETRY:  5,\n\n  _write: function(chunk) {\n    if (!this.writable) return false;\n    try {\n      return this._stream.write(chunk, 'utf8');\n    } catch (e) {\n      return false;\n    }\n  },\n\n  _open: function() {\n    if (this.readyState !== API.CONNECTING) return;\n\n    this.readyState = API.OPEN;\n\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n\n  write: function(message) {\n    return this.send(message);\n  },\n\n  end: function(message) {\n    if (message !== undefined) this.write(message);\n    this.close();\n  },\n\n  send: function(message, options) {\n    if (this.readyState > API.OPEN) return false;\n\n    message = String(message).replace(/(\\r\\n|\\r|\\n)/g, '$1data: ');\n    options = options || {};\n\n    var frame = '';\n    if (options.event) frame += 'event: ' + options.event + '\\r\\n';\n    if (options.id)    frame += 'id: '    + options.id    + '\\r\\n';\n    frame += 'data: ' + message + '\\r\\n\\r\\n';\n\n    return this._write(frame);\n  },\n\n  ping: function() {\n    return this._write(':\\r\\n\\r\\n');\n  },\n\n  close: function() {\n    if (this.readyState > API.OPEN) return false;\n\n    this.readyState = API.CLOSED;\n    this.writable = false;\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n\n    var event = new Event('close');\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n\n    return true;\n  }\n};\n\nfor (var method in instance) EventSource.prototype[method] = instance[method];\nfor (var key in EventTarget) EventSource.prototype[key] = EventTarget[key];\n\nmodule.exports = EventSource;\n"]},"metadata":{},"sourceType":"script"}