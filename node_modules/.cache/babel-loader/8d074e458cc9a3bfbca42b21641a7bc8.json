{"ast":null,"code":"// Generated by CoffeeScript 1.12.7\n(function () {\n  var FayeWebsocket,\n      RawWebsocketSessionReceiver,\n      Transport,\n      WebSocketReceiver,\n      transport,\n      utils,\n      extend = function (child, parent) {\n    for (var key in parent) {\n      if (hasProp.call(parent, key)) child[key] = parent[key];\n    }\n\n    function ctor() {\n      this.constructor = child;\n    }\n\n    ctor.prototype = parent.prototype;\n    child.prototype = new ctor();\n    child.__super__ = parent.prototype;\n    return child;\n  },\n      hasProp = {}.hasOwnProperty;\n\n  FayeWebsocket = require('faye-websocket');\n  utils = require('./utils');\n  transport = require('./transport');\n  exports.app = {\n    _websocket_check: function (req, connection, head) {\n      if (!FayeWebsocket.isWebSocket(req)) {\n        throw {\n          status: 400,\n          message: 'Not a valid websocket request'\n        };\n      }\n    },\n    sockjs_websocket: function (req, connection, head) {\n      var ws;\n\n      this._websocket_check(req, connection, head);\n\n      ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options);\n\n      ws.onopen = function (_this) {\n        return function () {\n          return transport.registerNoSession(req, _this, new WebSocketReceiver(ws, connection));\n        };\n      }(this);\n\n      return true;\n    },\n    raw_websocket: function (req, connection, head) {\n      var ver, ws;\n\n      this._websocket_check(req, connection, head);\n\n      ver = req.headers['sec-websocket-version'] || '';\n\n      if (['8', '13'].indexOf(ver) === -1) {\n        throw {\n          status: 400,\n          message: 'Only supported WebSocket protocol is RFC 6455.'\n        };\n      }\n\n      ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options);\n\n      ws.onopen = function (_this) {\n        return function () {\n          return new RawWebsocketSessionReceiver(req, connection, _this, ws);\n        };\n      }(this);\n\n      return true;\n    }\n  };\n\n  WebSocketReceiver = function (superClass) {\n    extend(WebSocketReceiver, superClass);\n    WebSocketReceiver.prototype.protocol = \"websocket\";\n\n    function WebSocketReceiver(ws1, connection1) {\n      var x;\n      this.ws = ws1;\n      this.connection = connection1;\n\n      try {\n        this.connection.setKeepAlive(true, 5000);\n        this.connection.setNoDelay(true);\n      } catch (error) {\n        x = error;\n      }\n\n      this.ws.addEventListener('message', function (_this) {\n        return function (m) {\n          return _this.didMessage(m.data);\n        };\n      }(this));\n\n      this.heartbeat_cb = function (_this) {\n        return function () {\n          return _this.heartbeat_timeout();\n        };\n      }(this);\n\n      WebSocketReceiver.__super__.constructor.call(this, this.connection);\n    }\n\n    WebSocketReceiver.prototype.setUp = function () {\n      WebSocketReceiver.__super__.setUp.apply(this, arguments);\n\n      return this.ws.addEventListener('close', this.thingy_end_cb);\n    };\n\n    WebSocketReceiver.prototype.tearDown = function () {\n      this.ws.removeEventListener('close', this.thingy_end_cb);\n      return WebSocketReceiver.__super__.tearDown.apply(this, arguments);\n    };\n\n    WebSocketReceiver.prototype.didMessage = function (payload) {\n      var i, len, message, msg, results, x;\n\n      if (this.ws && this.session && payload.length > 0) {\n        try {\n          message = JSON.parse(payload);\n        } catch (error) {\n          x = error;\n          return this.didClose(3000, 'Broken framing.');\n        }\n\n        if (payload[0] === '[') {\n          results = [];\n\n          for (i = 0, len = message.length; i < len; i++) {\n            msg = message[i];\n            results.push(this.session.didMessage(msg));\n          }\n\n          return results;\n        } else {\n          return this.session.didMessage(message);\n        }\n      }\n    };\n\n    WebSocketReceiver.prototype.doSendFrame = function (payload) {\n      var x;\n\n      if (this.ws) {\n        try {\n          this.ws.send(payload);\n          return true;\n        } catch (error) {\n          x = error;\n        }\n      }\n\n      return false;\n    };\n\n    WebSocketReceiver.prototype.didClose = function (status, reason) {\n      var x;\n\n      if (status == null) {\n        status = 1000;\n      }\n\n      if (reason == null) {\n        reason = \"Normal closure\";\n      }\n\n      WebSocketReceiver.__super__.didClose.apply(this, arguments);\n\n      try {\n        this.ws.close(status, reason, false);\n      } catch (error) {\n        x = error;\n      }\n\n      this.ws = null;\n      return this.connection = null;\n    };\n\n    WebSocketReceiver.prototype.heartbeat = function () {\n      var hto_ref, supportsHeartbeats;\n      supportsHeartbeats = this.ws.ping(null, function () {\n        return clearTimeout(hto_ref);\n      });\n\n      if (supportsHeartbeats) {\n        return hto_ref = setTimeout(this.heartbeat_cb, 10000);\n      } else {\n        return WebSocketReceiver.__super__.heartbeat.apply(this, arguments);\n      }\n    };\n\n    WebSocketReceiver.prototype.heartbeat_timeout = function () {\n      if (this.session != null) {\n        return this.session.close(3000, 'No response from heartbeat');\n      }\n    };\n\n    return WebSocketReceiver;\n  }(transport.GenericReceiver);\n\n  Transport = transport.Transport;\n\n  RawWebsocketSessionReceiver = function (superClass) {\n    extend(RawWebsocketSessionReceiver, superClass);\n\n    function RawWebsocketSessionReceiver(req, conn, server, ws1) {\n      this.ws = ws1;\n      this.prefix = server.options.prefix;\n      this.readyState = Transport.OPEN;\n      this.recv = {\n        connection: conn,\n        protocol: \"websocket-raw\"\n      };\n      this.connection = new transport.SockJSConnection(this);\n      this.decorateConnection(req);\n      server.emit('connection', this.connection);\n\n      this._end_cb = function (_this) {\n        return function () {\n          return _this.didClose();\n        };\n      }(this);\n\n      this.ws.addEventListener('close', this._end_cb);\n\n      this._message_cb = function (_this) {\n        return function (m) {\n          return _this.didMessage(m);\n        };\n      }(this);\n\n      this.ws.addEventListener('message', this._message_cb);\n    }\n\n    RawWebsocketSessionReceiver.prototype.didMessage = function (m) {\n      if (this.readyState === Transport.OPEN) {\n        this.connection.emit('data', m.data);\n      }\n    };\n\n    RawWebsocketSessionReceiver.prototype.send = function (payload) {\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n\n      this.ws.send(payload);\n      return true;\n    };\n\n    RawWebsocketSessionReceiver.prototype.close = function (status, reason) {\n      if (status == null) {\n        status = 1000;\n      }\n\n      if (reason == null) {\n        reason = \"Normal closure\";\n      }\n\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n\n      this.readyState = Transport.CLOSING;\n      this.ws.close(status, reason, false);\n      return true;\n    };\n\n    RawWebsocketSessionReceiver.prototype.didClose = function () {\n      var x;\n\n      if (!this.ws) {\n        return;\n      }\n\n      this.ws.removeEventListener('message', this._message_cb);\n      this.ws.removeEventListener('close', this._end_cb);\n\n      try {\n        this.ws.close(1000, \"Normal closure\", false);\n      } catch (error) {\n        x = error;\n      }\n\n      this.ws = null;\n      this.readyState = Transport.CLOSED;\n      this.connection.emit('end');\n      this.connection.emit('close');\n      return this.connection = null;\n    };\n\n    return RawWebsocketSessionReceiver;\n  }(transport.Session);\n}).call(this);","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/sockjs/lib/trans-websocket.js"],"names":["FayeWebsocket","RawWebsocketSessionReceiver","Transport","WebSocketReceiver","transport","utils","extend","child","parent","key","hasProp","call","ctor","constructor","prototype","__super__","hasOwnProperty","require","exports","app","_websocket_check","req","connection","head","isWebSocket","status","message","sockjs_websocket","ws","options","faye_server_options","onopen","_this","registerNoSession","raw_websocket","ver","headers","indexOf","superClass","protocol","ws1","connection1","x","setKeepAlive","setNoDelay","error","addEventListener","m","didMessage","data","heartbeat_cb","heartbeat_timeout","setUp","apply","arguments","thingy_end_cb","tearDown","removeEventListener","payload","i","len","msg","results","session","length","JSON","parse","didClose","push","doSendFrame","send","reason","close","heartbeat","hto_ref","supportsHeartbeats","ping","clearTimeout","setTimeout","GenericReceiver","conn","server","prefix","readyState","OPEN","recv","SockJSConnection","decorateConnection","emit","_end_cb","_message_cb","CLOSING","CLOSED","Session"],"mappings":"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","sourcesContent":["// Generated by CoffeeScript 1.12.7\n(function() {\n  var FayeWebsocket, RawWebsocketSessionReceiver, Transport, WebSocketReceiver, transport, utils,\n    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },\n    hasProp = {}.hasOwnProperty;\n\n  FayeWebsocket = require('faye-websocket');\n\n  utils = require('./utils');\n\n  transport = require('./transport');\n\n  exports.app = {\n    _websocket_check: function(req, connection, head) {\n      if (!FayeWebsocket.isWebSocket(req)) {\n        throw {\n          status: 400,\n          message: 'Not a valid websocket request'\n        };\n      }\n    },\n    sockjs_websocket: function(req, connection, head) {\n      var ws;\n      this._websocket_check(req, connection, head);\n      ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options);\n      ws.onopen = (function(_this) {\n        return function() {\n          return transport.registerNoSession(req, _this, new WebSocketReceiver(ws, connection));\n        };\n      })(this);\n      return true;\n    },\n    raw_websocket: function(req, connection, head) {\n      var ver, ws;\n      this._websocket_check(req, connection, head);\n      ver = req.headers['sec-websocket-version'] || '';\n      if (['8', '13'].indexOf(ver) === -1) {\n        throw {\n          status: 400,\n          message: 'Only supported WebSocket protocol is RFC 6455.'\n        };\n      }\n      ws = new FayeWebsocket(req, connection, head, null, this.options.faye_server_options);\n      ws.onopen = (function(_this) {\n        return function() {\n          return new RawWebsocketSessionReceiver(req, connection, _this, ws);\n        };\n      })(this);\n      return true;\n    }\n  };\n\n  WebSocketReceiver = (function(superClass) {\n    extend(WebSocketReceiver, superClass);\n\n    WebSocketReceiver.prototype.protocol = \"websocket\";\n\n    function WebSocketReceiver(ws1, connection1) {\n      var x;\n      this.ws = ws1;\n      this.connection = connection1;\n      try {\n        this.connection.setKeepAlive(true, 5000);\n        this.connection.setNoDelay(true);\n      } catch (error) {\n        x = error;\n      }\n      this.ws.addEventListener('message', (function(_this) {\n        return function(m) {\n          return _this.didMessage(m.data);\n        };\n      })(this));\n      this.heartbeat_cb = (function(_this) {\n        return function() {\n          return _this.heartbeat_timeout();\n        };\n      })(this);\n      WebSocketReceiver.__super__.constructor.call(this, this.connection);\n    }\n\n    WebSocketReceiver.prototype.setUp = function() {\n      WebSocketReceiver.__super__.setUp.apply(this, arguments);\n      return this.ws.addEventListener('close', this.thingy_end_cb);\n    };\n\n    WebSocketReceiver.prototype.tearDown = function() {\n      this.ws.removeEventListener('close', this.thingy_end_cb);\n      return WebSocketReceiver.__super__.tearDown.apply(this, arguments);\n    };\n\n    WebSocketReceiver.prototype.didMessage = function(payload) {\n      var i, len, message, msg, results, x;\n      if (this.ws && this.session && payload.length > 0) {\n        try {\n          message = JSON.parse(payload);\n        } catch (error) {\n          x = error;\n          return this.didClose(3000, 'Broken framing.');\n        }\n        if (payload[0] === '[') {\n          results = [];\n          for (i = 0, len = message.length; i < len; i++) {\n            msg = message[i];\n            results.push(this.session.didMessage(msg));\n          }\n          return results;\n        } else {\n          return this.session.didMessage(message);\n        }\n      }\n    };\n\n    WebSocketReceiver.prototype.doSendFrame = function(payload) {\n      var x;\n      if (this.ws) {\n        try {\n          this.ws.send(payload);\n          return true;\n        } catch (error) {\n          x = error;\n        }\n      }\n      return false;\n    };\n\n    WebSocketReceiver.prototype.didClose = function(status, reason) {\n      var x;\n      if (status == null) {\n        status = 1000;\n      }\n      if (reason == null) {\n        reason = \"Normal closure\";\n      }\n      WebSocketReceiver.__super__.didClose.apply(this, arguments);\n      try {\n        this.ws.close(status, reason, false);\n      } catch (error) {\n        x = error;\n      }\n      this.ws = null;\n      return this.connection = null;\n    };\n\n    WebSocketReceiver.prototype.heartbeat = function() {\n      var hto_ref, supportsHeartbeats;\n      supportsHeartbeats = this.ws.ping(null, function() {\n        return clearTimeout(hto_ref);\n      });\n      if (supportsHeartbeats) {\n        return hto_ref = setTimeout(this.heartbeat_cb, 10000);\n      } else {\n        return WebSocketReceiver.__super__.heartbeat.apply(this, arguments);\n      }\n    };\n\n    WebSocketReceiver.prototype.heartbeat_timeout = function() {\n      if (this.session != null) {\n        return this.session.close(3000, 'No response from heartbeat');\n      }\n    };\n\n    return WebSocketReceiver;\n\n  })(transport.GenericReceiver);\n\n  Transport = transport.Transport;\n\n  RawWebsocketSessionReceiver = (function(superClass) {\n    extend(RawWebsocketSessionReceiver, superClass);\n\n    function RawWebsocketSessionReceiver(req, conn, server, ws1) {\n      this.ws = ws1;\n      this.prefix = server.options.prefix;\n      this.readyState = Transport.OPEN;\n      this.recv = {\n        connection: conn,\n        protocol: \"websocket-raw\"\n      };\n      this.connection = new transport.SockJSConnection(this);\n      this.decorateConnection(req);\n      server.emit('connection', this.connection);\n      this._end_cb = (function(_this) {\n        return function() {\n          return _this.didClose();\n        };\n      })(this);\n      this.ws.addEventListener('close', this._end_cb);\n      this._message_cb = (function(_this) {\n        return function(m) {\n          return _this.didMessage(m);\n        };\n      })(this);\n      this.ws.addEventListener('message', this._message_cb);\n    }\n\n    RawWebsocketSessionReceiver.prototype.didMessage = function(m) {\n      if (this.readyState === Transport.OPEN) {\n        this.connection.emit('data', m.data);\n      }\n    };\n\n    RawWebsocketSessionReceiver.prototype.send = function(payload) {\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n      this.ws.send(payload);\n      return true;\n    };\n\n    RawWebsocketSessionReceiver.prototype.close = function(status, reason) {\n      if (status == null) {\n        status = 1000;\n      }\n      if (reason == null) {\n        reason = \"Normal closure\";\n      }\n      if (this.readyState !== Transport.OPEN) {\n        return false;\n      }\n      this.readyState = Transport.CLOSING;\n      this.ws.close(status, reason, false);\n      return true;\n    };\n\n    RawWebsocketSessionReceiver.prototype.didClose = function() {\n      var x;\n      if (!this.ws) {\n        return;\n      }\n      this.ws.removeEventListener('message', this._message_cb);\n      this.ws.removeEventListener('close', this._end_cb);\n      try {\n        this.ws.close(1000, \"Normal closure\", false);\n      } catch (error) {\n        x = error;\n      }\n      this.ws = null;\n      this.readyState = Transport.CLOSED;\n      this.connection.emit('end');\n      this.connection.emit('close');\n      return this.connection = null;\n    };\n\n    return RawWebsocketSessionReceiver;\n\n  })(transport.Session);\n\n}).call(this);\n"]},"metadata":{},"sourceType":"script"}