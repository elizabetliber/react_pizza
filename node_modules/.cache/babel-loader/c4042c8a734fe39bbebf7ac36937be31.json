{"ast":null,"code":"var hpack = require('../hpack');\n\nvar utils = hpack.utils;\nvar encoder = hpack.encoder;\nvar table = hpack.table;\nvar assert = utils.assert;\n\nvar inherits = require('inherits');\n\nvar Duplex = require('readable-stream').Duplex;\n\nfunction Compressor(options) {\n  Duplex.call(this, {\n    writableObjectMode: true\n  });\n  this._encoder = null;\n  this._table = table.create(options.table);\n}\n\ninherits(Compressor, Duplex);\nmodule.exports = Compressor;\n\nCompressor.create = function create(options) {\n  return new Compressor(options);\n};\n\nCompressor.prototype._read = function _read() {// We only push!\n};\n\nCompressor.prototype._write = function _write(data, enc, cb) {\n  assert(Array.isArray(data), 'Compressor.write() expects list of headers');\n  this._encoder = encoder.create();\n\n  for (var i = 0; i < data.length; i++) this._encodeHeader(data[i]);\n\n  var data = this._encoder.render();\n\n  this._encoder = null;\n  cb(null);\n\n  for (var i = 0; i < data.length; i++) this.push(data[i]);\n};\n\nCompressor.prototype.updateTableSize = function updateTableSize(size) {\n  if (size >= this._table.protocolMaxSize) {\n    size = this._table.protocolMaxSize;\n    var enc = encoder.create(); // indexed = 0\n    // incremental = 0\n    // update = 1\n\n    enc.encodeBits(1, 3);\n    enc.encodeInt(size);\n    var data = enc.render();\n\n    for (var i = 0; i < data.length; i++) this.push(data[i]);\n  }\n\n  this._table.updateSize(size);\n};\n\nCompressor.prototype.reset = function reset() {\n  var enc = encoder.create();\n  var size = this._table.maxSize; // indexed = 0\n  // incremental = 0\n  // update = 1\n\n  enc.encodeBits(1, 3);\n  enc.encodeInt(0); // Evict everything\n\n  this._table.updateSize(0); // indexed = 0\n  // incremental = 0\n  // update = 1\n\n\n  enc.encodeBits(1, 3);\n  enc.encodeInt(size); // Revert size\n\n  this._table.updateSize(size);\n\n  var data = enc.render();\n\n  for (var i = 0; i < data.length; i++) this.push(data[i]);\n};\n\nCompressor.prototype._encodeHeader = function _encodeHeader(header) {\n  if (header.neverIndex) {\n    var index = 0;\n    var neverIndex = 1;\n    var isIndexed = 0;\n    var isIncremental = 0;\n  } else {\n    var index = this._table.reverseLookup(header.name, header.value);\n\n    var isIndexed = index > 0;\n    var isIncremental = header.incremental !== false;\n    var neverIndex = 0;\n  }\n\n  this._encoder.encodeBit(isIndexed);\n\n  if (isIndexed) {\n    this._encoder.encodeInt(index);\n\n    return;\n  }\n\n  var name = utils.toArray(header.name);\n  var value = utils.toArray(header.value);\n\n  this._encoder.encodeBit(isIncremental);\n\n  if (isIncremental) {\n    this._table.add(header.name, header.value, name.length, value.length);\n  } else {\n    // Update = false\n    this._encoder.encodeBit(0);\n\n    this._encoder.encodeBit(neverIndex);\n  } // index is negative for `name`-only headers\n\n\n  this._encoder.encodeInt(-index);\n\n  if (index === 0) this._encoder.encodeStr(name, header.huffman !== false);\n\n  this._encoder.encodeStr(value, header.huffman !== false);\n};","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/hpack.js/lib/hpack/compressor.js"],"names":["hpack","require","utils","encoder","table","assert","inherits","Duplex","Compressor","options","call","writableObjectMode","_encoder","_table","create","module","exports","prototype","_read","_write","data","enc","cb","Array","isArray","i","length","_encodeHeader","render","push","updateTableSize","size","protocolMaxSize","encodeBits","encodeInt","updateSize","reset","maxSize","header","neverIndex","index","isIndexed","isIncremental","reverseLookup","name","value","incremental","encodeBit","toArray","add","encodeStr","huffman"],"mappings":"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","sourcesContent":["var hpack = require('../hpack');\nvar utils = hpack.utils;\nvar encoder = hpack.encoder;\nvar table = hpack.table;\nvar assert = utils.assert;\n\nvar inherits = require('inherits');\nvar Duplex = require('readable-stream').Duplex;\n\nfunction Compressor(options) {\n  Duplex.call(this, {\n    writableObjectMode: true\n  });\n\n  this._encoder = null;\n  this._table = table.create(options.table);\n}\ninherits(Compressor, Duplex);\nmodule.exports = Compressor;\n\nCompressor.create = function create(options) {\n  return new Compressor(options);\n};\n\nCompressor.prototype._read = function _read() {\n  // We only push!\n};\n\nCompressor.prototype._write = function _write(data, enc, cb) {\n  assert(Array.isArray(data), 'Compressor.write() expects list of headers');\n\n  this._encoder = encoder.create();\n  for (var i = 0; i < data.length; i++)\n    this._encodeHeader(data[i]);\n\n  var data = this._encoder.render();\n  this._encoder = null;\n\n  cb(null);\n  for (var i = 0; i < data.length; i++)\n    this.push(data[i]);\n};\n\nCompressor.prototype.updateTableSize = function updateTableSize(size) {\n  if (size >= this._table.protocolMaxSize) {\n    size = this._table.protocolMaxSize;\n\n    var enc = encoder.create();\n\n    // indexed = 0\n    // incremental = 0\n    // update = 1\n    enc.encodeBits(1, 3);\n    enc.encodeInt(size);\n\n    var data = enc.render();\n    for (var i = 0; i < data.length; i++)\n      this.push(data[i]);\n  }\n\n  this._table.updateSize(size);\n};\n\nCompressor.prototype.reset = function reset() {\n  var enc = encoder.create();\n  var size = this._table.maxSize;\n\n  // indexed = 0\n  // incremental = 0\n  // update = 1\n  enc.encodeBits(1, 3);\n  enc.encodeInt(0);\n\n  // Evict everything\n  this._table.updateSize(0);\n\n  // indexed = 0\n  // incremental = 0\n  // update = 1\n  enc.encodeBits(1, 3);\n  enc.encodeInt(size);\n\n  // Revert size\n  this._table.updateSize(size);\n\n  var data = enc.render();\n  for (var i = 0; i < data.length; i++)\n    this.push(data[i]);\n};\n\nCompressor.prototype._encodeHeader = function _encodeHeader(header) {\n  if (header.neverIndex) {\n    var index = 0;\n    var neverIndex = 1;\n    var isIndexed = 0;\n    var isIncremental = 0;\n  } else {\n    var index = this._table.reverseLookup(header.name, header.value);\n    var isIndexed = index > 0;\n    var isIncremental = header.incremental !== false;\n    var neverIndex = 0;\n  }\n\n  this._encoder.encodeBit(isIndexed);\n  if (isIndexed) {\n    this._encoder.encodeInt(index);\n    return;\n  }\n\n  var name = utils.toArray(header.name);\n  var value = utils.toArray(header.value);\n\n  this._encoder.encodeBit(isIncremental);\n  if (isIncremental) {\n    this._table.add(header.name, header.value, name.length, value.length);\n  } else {\n    // Update = false\n    this._encoder.encodeBit(0);\n    this._encoder.encodeBit(neverIndex);\n  }\n\n  // index is negative for `name`-only headers\n  this._encoder.encodeInt(-index);\n  if (index === 0)\n    this._encoder.encodeStr(name, header.huffman !== false);\n  this._encoder.encodeStr(value, header.huffman !== false);\n};\n"]},"metadata":{},"sourceType":"script"}