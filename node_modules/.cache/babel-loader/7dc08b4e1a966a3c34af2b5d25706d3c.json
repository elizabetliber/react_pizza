{"ast":null,"code":"'use strict';\n\nvar util = require('util'),\n    HttpParser = require('../http_parser'),\n    Base = require('./base'),\n    Draft75 = require('./draft75'),\n    Draft76 = require('./draft76'),\n    Hybi = require('./hybi');\n\nvar Server = function (options) {\n  Base.call(this, null, null, options);\n  this._http = new HttpParser('request');\n};\n\nutil.inherits(Server, Base);\nvar instance = {\n  EVENTS: ['open', 'message', 'error', 'close', 'ping', 'pong'],\n  _bindEventListeners: function () {\n    this.messages.on('error', function () {});\n    this.on('error', function () {});\n  },\n  parse: function (chunk) {\n    if (this._delegate) return this._delegate.parse(chunk);\n\n    this._http.parse(chunk);\n\n    if (!this._http.isComplete()) return;\n    this.method = this._http.method;\n    this.url = this._http.url;\n    this.headers = this._http.headers;\n    this.body = this._http.body;\n    var self = this;\n    this._delegate = Server.http(this, this._options);\n    this._delegate.messages = this.messages;\n    this._delegate.io = this.io;\n\n    this._open();\n\n    this.EVENTS.forEach(function (event) {\n      this._delegate.on(event, function (e) {\n        self.emit(event, e);\n      });\n    }, this);\n    this.protocol = this._delegate.protocol;\n    this.version = this._delegate.version;\n    this.parse(this._http.body);\n    this.emit('connect', new Base.ConnectEvent());\n  },\n  _open: function () {\n    this.__queue.forEach(function (msg) {\n      this._delegate[msg[0]].apply(this._delegate, msg[1]);\n    }, this);\n\n    this.__queue = [];\n  }\n};\n['addExtension', 'setHeader', 'start', 'frame', 'text', 'binary', 'ping', 'close'].forEach(function (method) {\n  instance[method] = function () {\n    if (this._delegate) {\n      return this._delegate[method].apply(this._delegate, arguments);\n    } else {\n      this.__queue.push([method, arguments]);\n\n      return true;\n    }\n  };\n});\n\nfor (var key in instance) Server.prototype[key] = instance[key];\n\nServer.isSecureRequest = function (request) {\n  if (request.connection && request.connection.authorized !== undefined) return true;\n  if (request.socket && request.socket.secure) return true;\n  var headers = request.headers;\n  if (!headers) return false;\n  if (headers['https'] === 'on') return true;\n  if (headers['x-forwarded-ssl'] === 'on') return true;\n  if (headers['x-forwarded-scheme'] === 'https') return true;\n  if (headers['x-forwarded-proto'] === 'https') return true;\n  return false;\n};\n\nServer.determineUrl = function (request) {\n  var scheme = this.isSecureRequest(request) ? 'wss:' : 'ws:';\n  return scheme + '//' + request.headers.host + request.url;\n};\n\nServer.http = function (request, options) {\n  options = options || {};\n  if (options.requireMasking === undefined) options.requireMasking = true;\n  var headers = request.headers,\n      version = headers['sec-websocket-version'],\n      key = headers['sec-websocket-key'],\n      key1 = headers['sec-websocket-key1'],\n      key2 = headers['sec-websocket-key2'],\n      url = this.determineUrl(request);\n  if (version || key) return new Hybi(request, url, options);else if (key1 || key2) return new Draft76(request, url, options);else return new Draft75(request, url, options);\n};\n\nmodule.exports = Server;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/websocket-driver/lib/websocket/driver/server.js"],"names":["util","require","HttpParser","Base","Draft75","Draft76","Hybi","Server","options","call","_http","inherits","instance","EVENTS","_bindEventListeners","messages","on","parse","chunk","_delegate","isComplete","method","url","headers","body","self","http","_options","io","_open","forEach","event","e","emit","protocol","version","ConnectEvent","__queue","msg","apply","arguments","push","key","prototype","isSecureRequest","request","connection","authorized","undefined","socket","secure","determineUrl","scheme","host","requireMasking","key1","key2","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar util       = require('util'),\n    HttpParser = require('../http_parser'),\n    Base       = require('./base'),\n    Draft75    = require('./draft75'),\n    Draft76    = require('./draft76'),\n    Hybi       = require('./hybi');\n\nvar Server = function(options) {\n  Base.call(this, null, null, options);\n  this._http = new HttpParser('request');\n};\nutil.inherits(Server, Base);\n\nvar instance = {\n  EVENTS: ['open', 'message', 'error', 'close', 'ping', 'pong'],\n\n  _bindEventListeners: function() {\n    this.messages.on('error', function() {});\n    this.on('error', function() {});\n  },\n\n  parse: function(chunk) {\n    if (this._delegate) return this._delegate.parse(chunk);\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return;\n\n    this.method  = this._http.method;\n    this.url     = this._http.url;\n    this.headers = this._http.headers;\n    this.body    = this._http.body;\n\n    var self = this;\n    this._delegate = Server.http(this, this._options);\n    this._delegate.messages = this.messages;\n    this._delegate.io = this.io;\n    this._open();\n\n    this.EVENTS.forEach(function(event) {\n      this._delegate.on(event, function(e) { self.emit(event, e) });\n    }, this);\n\n    this.protocol = this._delegate.protocol;\n    this.version  = this._delegate.version;\n\n    this.parse(this._http.body);\n    this.emit('connect', new Base.ConnectEvent());\n  },\n\n  _open: function() {\n    this.__queue.forEach(function(msg) {\n      this._delegate[msg[0]].apply(this._delegate, msg[1]);\n    }, this);\n    this.__queue = [];\n  }\n};\n\n['addExtension', 'setHeader', 'start', 'frame', 'text', 'binary', 'ping', 'close'].forEach(function(method) {\n  instance[method] = function() {\n    if (this._delegate) {\n      return this._delegate[method].apply(this._delegate, arguments);\n    } else {\n      this.__queue.push([method, arguments]);\n      return true;\n    }\n  };\n});\n\nfor (var key in instance)\n  Server.prototype[key] = instance[key];\n\nServer.isSecureRequest = function(request) {\n  if (request.connection && request.connection.authorized !== undefined) return true;\n  if (request.socket && request.socket.secure) return true;\n\n  var headers = request.headers;\n  if (!headers) return false;\n  if (headers['https'] === 'on') return true;\n  if (headers['x-forwarded-ssl'] === 'on') return true;\n  if (headers['x-forwarded-scheme'] === 'https') return true;\n  if (headers['x-forwarded-proto'] === 'https') return true;\n\n  return false;\n};\n\nServer.determineUrl = function(request) {\n  var scheme = this.isSecureRequest(request) ? 'wss:' : 'ws:';\n  return scheme + '//' + request.headers.host + request.url;\n};\n\nServer.http = function(request, options) {\n  options = options || {};\n  if (options.requireMasking === undefined) options.requireMasking = true;\n\n  var headers = request.headers,\n      version = headers['sec-websocket-version'],\n      key     = headers['sec-websocket-key'],\n      key1    = headers['sec-websocket-key1'],\n      key2    = headers['sec-websocket-key2'],\n      url     = this.determineUrl(request);\n\n  if (version || key)\n    return new Hybi(request, url, options);\n  else if (key1 || key2)\n    return new Draft76(request, url, options);\n  else\n    return new Draft75(request, url, options);\n};\n\nmodule.exports = Server;\n"]},"metadata":{},"sourceType":"script"}