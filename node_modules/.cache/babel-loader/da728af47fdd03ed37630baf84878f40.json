{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer,\n    Emitter = require('events').EventEmitter,\n    util = require('util'),\n    streams = require('../streams'),\n    Headers = require('./headers'),\n    Reader = require('./stream_reader');\n\nvar Base = function (request, url, options) {\n  Emitter.call(this);\n  Base.validateOptions(options || {}, ['maxLength', 'masking', 'requireMasking', 'protocols']);\n  this._request = request;\n  this._reader = new Reader();\n  this._options = options || {};\n  this._maxLength = this._options.maxLength || this.MAX_LENGTH;\n  this._headers = new Headers();\n  this.__queue = [];\n  this.readyState = 0;\n  this.url = url;\n  this.io = new streams.IO(this);\n  this.messages = new streams.Messages(this);\n\n  this._bindEventListeners();\n};\n\nutil.inherits(Base, Emitter);\n\nBase.isWebSocket = function (request) {\n  var connection = request.headers.connection || '',\n      upgrade = request.headers.upgrade || '';\n  return request.method === 'GET' && connection.toLowerCase().split(/ *, */).indexOf('upgrade') >= 0 && upgrade.toLowerCase() === 'websocket';\n};\n\nBase.validateOptions = function (options, validKeys) {\n  for (var key in options) {\n    if (validKeys.indexOf(key) < 0) throw new Error('Unrecognized option: ' + key);\n  }\n};\n\nvar instance = {\n  // This is 64MB, small enough for an average VPS to handle without\n  // crashing from process out of memory\n  MAX_LENGTH: 0x3ffffff,\n  STATES: ['connecting', 'open', 'closing', 'closed'],\n  _bindEventListeners: function () {\n    var self = this; // Protocol errors are informational and do not have to be handled\n\n    this.messages.on('error', function () {});\n    this.on('message', function (event) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('data', event.data);\n    });\n    this.on('error', function (error) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('error', error);\n    });\n    this.on('close', function () {\n      var messages = self.messages;\n      if (!messages.readable) return;\n      messages.readable = messages.writable = false;\n      messages.emit('end');\n    });\n  },\n  getState: function () {\n    return this.STATES[this.readyState] || null;\n  },\n  addExtension: function (extension) {\n    return false;\n  },\n  setHeader: function (name, value) {\n    if (this.readyState > 0) return false;\n\n    this._headers.set(name, value);\n\n    return true;\n  },\n  start: function () {\n    if (this.readyState !== 0) return false;\n    if (!Base.isWebSocket(this._request)) return this._failHandshake(new Error('Not a WebSocket request'));\n    var response;\n\n    try {\n      response = this._handshakeResponse();\n    } catch (error) {\n      return this._failHandshake(error);\n    }\n\n    this._write(response);\n\n    if (this._stage !== -1) this._open();\n    return true;\n  },\n  _failHandshake: function (error) {\n    var headers = new Headers();\n    headers.set('Content-Type', 'text/plain');\n    headers.set('Content-Length', Buffer.byteLength(error.message, 'utf8'));\n    headers = ['HTTP/1.1 400 Bad Request', headers.toString(), error.message];\n\n    this._write(Buffer.from(headers.join('\\r\\n'), 'utf8'));\n\n    this._fail('protocol_error', error.message);\n\n    return false;\n  },\n  text: function (message) {\n    return this.frame(message);\n  },\n  binary: function (message) {\n    return false;\n  },\n  ping: function () {\n    return false;\n  },\n  pong: function () {\n    return false;\n  },\n  close: function (reason, code) {\n    if (this.readyState !== 1) return false;\n    this.readyState = 3;\n    this.emit('close', new Base.CloseEvent(null, null));\n    return true;\n  },\n  _open: function () {\n    this.readyState = 1;\n\n    this.__queue.forEach(function (args) {\n      this.frame.apply(this, args);\n    }, this);\n\n    this.__queue = [];\n    this.emit('open', new Base.OpenEvent());\n  },\n  _queue: function (message) {\n    this.__queue.push(message);\n\n    return true;\n  },\n  _write: function (chunk) {\n    var io = this.io;\n    if (io.readable) io.emit('data', chunk);\n  },\n  _fail: function (type, message) {\n    this.readyState = 2;\n    this.emit('error', new Error(message));\n    this.close();\n  }\n};\n\nfor (var key in instance) Base.prototype[key] = instance[key];\n\nBase.ConnectEvent = function () {};\n\nBase.OpenEvent = function () {};\n\nBase.CloseEvent = function (code, reason) {\n  this.code = code;\n  this.reason = reason;\n};\n\nBase.MessageEvent = function (data) {\n  this.data = data;\n};\n\nBase.PingEvent = function (data) {\n  this.data = data;\n};\n\nBase.PongEvent = function (data) {\n  this.data = data;\n};\n\nmodule.exports = Base;","map":{"version":3,"sources":["/home/lisa/VSProjects/react-pizza/react_pizza/node_modules/websocket-driver/lib/websocket/driver/base.js"],"names":["Buffer","require","Emitter","EventEmitter","util","streams","Headers","Reader","Base","request","url","options","call","validateOptions","_request","_reader","_options","_maxLength","maxLength","MAX_LENGTH","_headers","__queue","readyState","io","IO","messages","Messages","_bindEventListeners","inherits","isWebSocket","connection","headers","upgrade","method","toLowerCase","split","indexOf","validKeys","key","Error","instance","STATES","self","on","event","readable","emit","data","error","writable","getState","addExtension","extension","setHeader","name","value","set","start","_failHandshake","response","_handshakeResponse","_write","_stage","_open","byteLength","message","toString","from","join","_fail","text","frame","binary","ping","pong","close","reason","code","CloseEvent","forEach","args","apply","OpenEvent","_queue","push","chunk","type","prototype","ConnectEvent","MessageEvent","PingEvent","PongEvent","module","exports"],"mappings":"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","sourcesContent":["'use strict';\n\nvar Buffer  = require('safe-buffer').Buffer,\n    Emitter = require('events').EventEmitter,\n    util    = require('util'),\n    streams = require('../streams'),\n    Headers = require('./headers'),\n    Reader  = require('./stream_reader');\n\nvar Base = function(request, url, options) {\n  Emitter.call(this);\n  Base.validateOptions(options || {}, ['maxLength', 'masking', 'requireMasking', 'protocols']);\n\n  this._request   = request;\n  this._reader    = new Reader();\n  this._options   = options || {};\n  this._maxLength = this._options.maxLength || this.MAX_LENGTH;\n  this._headers   = new Headers();\n  this.__queue    = [];\n  this.readyState = 0;\n  this.url        = url;\n\n  this.io = new streams.IO(this);\n  this.messages = new streams.Messages(this);\n  this._bindEventListeners();\n};\nutil.inherits(Base, Emitter);\n\nBase.isWebSocket = function(request) {\n  var connection = request.headers.connection || '',\n      upgrade    = request.headers.upgrade || '';\n\n  return request.method === 'GET' &&\n         connection.toLowerCase().split(/ *, */).indexOf('upgrade') >= 0 &&\n         upgrade.toLowerCase() === 'websocket';\n};\n\nBase.validateOptions = function(options, validKeys) {\n  for (var key in options) {\n    if (validKeys.indexOf(key) < 0)\n      throw new Error('Unrecognized option: ' + key);\n  }\n};\n\nvar instance = {\n  // This is 64MB, small enough for an average VPS to handle without\n  // crashing from process out of memory\n  MAX_LENGTH: 0x3ffffff,\n\n  STATES: ['connecting', 'open', 'closing', 'closed'],\n\n  _bindEventListeners: function() {\n    var self = this;\n\n    // Protocol errors are informational and do not have to be handled\n    this.messages.on('error', function() {});\n\n    this.on('message', function(event) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('data', event.data);\n    });\n\n    this.on('error', function(error) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('error', error);\n    });\n\n    this.on('close', function() {\n      var messages = self.messages;\n      if (!messages.readable) return;\n      messages.readable = messages.writable = false;\n      messages.emit('end');\n    });\n  },\n\n  getState: function() {\n    return this.STATES[this.readyState] || null;\n  },\n\n  addExtension: function(extension) {\n    return false;\n  },\n\n  setHeader: function(name, value) {\n    if (this.readyState > 0) return false;\n    this._headers.set(name, value);\n    return true;\n  },\n\n  start: function() {\n    if (this.readyState !== 0) return false;\n\n    if (!Base.isWebSocket(this._request))\n      return this._failHandshake(new Error('Not a WebSocket request'));\n\n    var response;\n\n    try {\n      response = this._handshakeResponse();\n    } catch (error) {\n      return this._failHandshake(error);\n    }\n\n    this._write(response);\n    if (this._stage !== -1) this._open();\n    return true;\n  },\n\n  _failHandshake: function(error) {\n    var headers = new Headers();\n    headers.set('Content-Type', 'text/plain');\n    headers.set('Content-Length', Buffer.byteLength(error.message, 'utf8'));\n\n    headers = ['HTTP/1.1 400 Bad Request', headers.toString(), error.message];\n    this._write(Buffer.from(headers.join('\\r\\n'), 'utf8'));\n    this._fail('protocol_error', error.message);\n\n    return false;\n  },\n\n  text: function(message) {\n    return this.frame(message);\n  },\n\n  binary: function(message) {\n    return false;\n  },\n\n  ping: function() {\n    return false;\n  },\n\n  pong: function() {\n      return false;\n  },\n\n  close: function(reason, code) {\n    if (this.readyState !== 1) return false;\n    this.readyState = 3;\n    this.emit('close', new Base.CloseEvent(null, null));\n    return true;\n  },\n\n  _open: function() {\n    this.readyState = 1;\n    this.__queue.forEach(function(args) { this.frame.apply(this, args) }, this);\n    this.__queue = [];\n    this.emit('open', new Base.OpenEvent());\n  },\n\n  _queue: function(message) {\n    this.__queue.push(message);\n    return true;\n  },\n\n  _write: function(chunk) {\n    var io = this.io;\n    if (io.readable) io.emit('data', chunk);\n  },\n\n  _fail: function(type, message) {\n    this.readyState = 2;\n    this.emit('error', new Error(message));\n    this.close();\n  }\n};\n\nfor (var key in instance)\n  Base.prototype[key] = instance[key];\n\n\nBase.ConnectEvent = function() {};\n\nBase.OpenEvent = function() {};\n\nBase.CloseEvent = function(code, reason) {\n  this.code   = code;\n  this.reason = reason;\n};\n\nBase.MessageEvent = function(data) {\n  this.data = data;\n};\n\nBase.PingEvent = function(data) {\n  this.data = data;\n};\n\nBase.PongEvent = function(data) {\n  this.data = data;\n};\n\nmodule.exports = Base;\n"]},"metadata":{},"sourceType":"script"}